<!DOCTYPE HTML>
<html>
<head>
  <title>{{ title }}</title>
  {{#each cssUrls}}
    <link rel="stylesheet" href="{{ this }}">
  {{/each}}
  {{{ meta }}}
  {{#if currentUrlAfterRedirect }}
    <script>
      try {
        history.replaceState({}, {{json title}}, {{json currentUrlAfterRedirect}});
      } catch (e) {}
    </script>
  {{/if}}
</head>
<body>{{{ body }}}
  <script>
    window.skit = {
      objects: {}
    };
  </script>
  {{#each scriptUrls}}
    <script src="{{ this }}"></script>
  {{/each}}
  <script>
    (function() {
      {{#if clientProxyObjects}}
        var netproxy = window.skit.objects[{{json netproxyModulePath}}];
        if (netproxy) {
          {{#each clientProxyObjects}}
            netproxy.__register__({{json name}}, {{json this}});
          {{/each}}
        }
      {{/if}}

      var ControllerKlass = window.skit.objects[{{json controllerModulePath }}];

      var controllersToLoadInOrder = [];
      var CurrentControllerKlass = ControllerKlass;
      while (CurrentControllerKlass) {
        controllersToLoadInOrder.unshift(CurrentControllerKlass);
        CurrentControllerKlass = CurrentControllerKlass.__parent__;
      }

      var controller = new ControllerKlass({{json requestWrap }});
      var allControllerArgs = {{json allControllerArgs }};
      for (var i = 0; i < controllersToLoadInOrder.length; i++) {
        if (controllersToLoadInOrder[i].prototype.__load__) {
          controllersToLoadInOrder[i].prototype.__load__.apply(controller, allControllerArgs[i]);
        }
      }
      controller.__ready__();
    })()
  </script>
</body>